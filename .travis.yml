dist: xenial
sudo: false
language: cpp
os: linux
compiler: gcc

addons:
    apt:
        packages:
            - lcov

before_install:
    - export TRAVIS_COMPILER=g++-8
    - export CXX=g++-8
    - export CXX_FOR_BUILD=g++-8
    - export CC=gcc-8
    - export CC_FOR_BUILD=gcc-8
    - sudo apt-get -qq update
    - sudo apt-get install -y cmake
    - sudo apt-get install -y libgtest-dev
    - sudo pip install codecov
    - cd /usr/src/gtest
    - sudo cmake CMakeLists.txt
    - sudo make
    - sudo cp *.a /usr/lib
    - cd -

install: 
    - sudo update-alternatives --install /usr/bin/gcov gcov /usr/bin/gcov-8 50

script:
    - mkdir build
    - cd build
    - cmake -DCMAKE_BUILD_TYPE=coverage -DCMAKE_C_COMPILER=gcc-8 -DCMAKE_CXX_COMPILER=g++-8 -DUNIT_TESTING=true ..
    - make && make test

after_success:
    - g++ --version
    - gcov --version
    - lcov --capture --directory . --output-file coverage.info
    - lcov --remove coverage.info '/usr/*' --output-file coverage.info
    - lcov --list coverage.info
    - bash <(curl -s https://codecov.io/bash) -t "57886efc-8eca-416f-9e8b-1b0ee825efe5" -f coverage.info || echo "Codecov did not collect coverage reports"

# notifications:
#   email:
#     - fjmw201@exeter.ac.uk
